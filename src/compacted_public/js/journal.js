// minified by avy <3
function getDayOfWeek(e,t,n){t<3&&(t+=12,e-=1);let o=e%100,a=Math.floor(e/100);return((n+Math.floor(13*(t+1)/5)+o+Math.floor(o/4)+Math.floor(a/4)+5*a)%7+5)%7+1}const monthLookup={"01":"January","02":"February","03":"March","04":"April","05":"May","06":"June","07":"July","08":"August","09":"September",10:"October",11:"November",12:"December"},daysOfWeek=["","MON","TUE","WED","THU","FRI","SAT","SUN"];function getWeekIndex(e){let[t,n,o]=e.split("-").map(Number);return[daysOfWeek[getDayOfWeek(t,n,o)],o]}function formatMonthDate(e){const t=e.slice(0,4),n=e.slice(5,7),o=e.slice(8,10);return`${monthLookup[n]} ${o}, ${t}`}function getTimeSt(){return(new Date).toISOString().split("T")[0]}function downloadTxt(e,t){const n=t.split(".").pop().toLowerCase();let o;if("txt"===n)o="text/plain";else{if("enc"!==n)return void console.error("Unsupported file format. Please use .txt or .enc");o="application/octet-stream"}const a=new Blob([e],{type:"text/plain"}),r=document.createElement("a");r.href=URL.createObjectURL(a),r.download=t,"txt"===n?(r.target="_blank",r.rel="noopener"):"enc"===n&&(r.target="",r.rel=""),document.body.appendChild(r),r.click(),document.body.removeChild(r)}function xorEncryptDecrypt(e,t){let n="";for(let o=0;o<e.length;o++){const a=t.charCodeAt(o%t.length)^o;n+=String.fromCharCode(e.charCodeAt(o)^a)}return n}function clearDropDown(){document.querySelectorAll(".navbutton").forEach((e=>e.classList.remove("active"))),document.querySelectorAll(".dropDown").forEach((e=>{e.style.height="0",setTimeout((()=>{e.remove()}),300)}))}function newDButton(e,t){const n=document.createElement("button");return n.className="dbutton",n.setAttribute("onclick",t),n.textContent=" ‣ "+e,n}function newDButtonCB(e,t){const n=document.createElement("button");return n.className="dbutton",n.onclick=t,n.textContent=" ‣ "+e,n}function newInputDButton(e,t){const n=document.createElement("input");return n.type="text",n.placeholder=e,n.addEventListener("blur",(()=>{t(n)})),n.addEventListener("keypress",(e=>{"Enter"===e.key&&n.blur()})),n}const categoryTemplate={topic:"New Category",creationTimestamp:""},entryTemplate={date:"",value:""};let editingEntry,journal={author:"",title:"",creationTimestamp:getTimeSt(),categories:[{topic:"Work",creationTimestamp:getTimeSt()},{topic:"Personal",creationTimestamp:getTimeSt()},{topic:"Travel",creationTimestamp:getTimeSt()}],entries:{"Website Redesign":{date:getTimeSt(),value:"Deadline Sep 30 I wanna cry :sob:",category:0},"HTML Fruit Radio":{date:getTimeSt(),value:'<form>\n        <label>\n            <input type="radio" name="fruit" value="apple" required>\n            Apple\n        </label><br>\n        \n        <label>\n            <input type="radio" name="fruit" value="banana">\n            Banana\n        </label><br>\n        \n        <label>\n            <input type="radio" name="fruit" value="orange">\n            Orange\n        </label><br>\n        \n        <label>\n            <input type="radio" name="fruit" value="grape">\n            Grape\n        </label><br>\n        \n        <button type="submit">Submit</button>\n    </form>',category:0},Hike:{date:getTimeSt(),value:"I LOVE HIKING SO MUCH!!",category:2}}},journalPassword="";function deleteCategory(e,t){let n=[];for(let e in journal.entries){journal.entries[e].category===t&&n.push(e)}if(0==n.length){journal.categories.splice(0,1);for(let e in journal.entries){console.log("r",e);const n=journal.entries[e];n.category>t&&(journal.entries[e].category=n.category-1)}loadJournal()}else{if(confirm(`delete ${n.length} entries inside \`${journal.categories[t].topic}?\``)){n.forEach((e=>{delete journal.entries[e]}));for(let e in journal.entries){console.log("r",e);const n=journal.entries[e];n.category>t&&(journal.entries[e].category=n.category-1)}journal.categories.splice(0,1)}loadJournal()}}function newEntry(e,t){let n=Object.assign({},entryTemplate),o="???";n.date=getTimeSt(),n.category=t,journal.categories.length<=t&&(console.log("is short"),journal.categories.splice(t,0,Object.assign({},categoryTemplate)));const a=e.getBoundingClientRect(),r=document.createElement("div");r.classList.add("dropDown"),r.appendChild(newInputDButton("Name",(function(e){const t=String(e.value),n=t.length>32?t.substring(0,32):t;if(journal.entries[o])return e.placeholder="name a",void(e.value="");o=n,e.value=n})));const l=document.createElement("input");l.type="date",l.className="dbuttonDate",l.placeholder="Select a date",l.addEventListener("change",(function(e){const t=e.target.value;n.date=t,console.log("Selected date:",t)})),r.appendChild(l),r.appendChild(newDButtonCB("Create",(function(e){journal.entries[o]=n,loadJournal()}))),document.body.appendChild(r),r.style.position="absolute",r.style.left=`${a.left+a.width}px`,r.style.top=`${a.top}px`,setTimeout((()=>{r.style.height="100px"}),1)}function makeEntry(e){newEntry(e,0)}function makeCategory(e){let t=Object.assign({},categoryTemplate);const n=e.getBoundingClientRect(),o=document.createElement("div");o.classList.add("dropDown"),o.appendChild(newInputDButton("Name Category",(function(e){const n=String(e.value),o=n.length>32?n.substring(0,32):n;t.topic=o,e.value=o}))),o.appendChild(newDButtonCB("Create",(function(e){t.creationTimestamp=getTimeSt(),journal.categories.splice(0,0,t);for(let e in journal.entries){const t=journal.entries[e];journal.entries[e].category=t.category+1}loadJournal()}))),document.body.appendChild(o),o.style.position="absolute",o.style.left=`${n.left+n.width}px`,o.style.top=`${n.top}px`,setTimeout((()=>{o.style.height="100px"}),1)}function changePassword(e,t){e.innerText="";let n=!1;const o=document.createElement("input");journalPassword.length>0?(o.type="password",o.placeholder="Enter OLD password"):(n=!0,o.type="text",o.placeholder="Enter NEW password"),e.replaceWith(o),o.focus(),o.addEventListener("blur",(()=>{if(0==n)o.value==journalPassword?(n=!0,o.value="",o.type="text",o.placeholder="Enter NEW password",console.log("password verified")):alert("wrong password");else{const e=String(o.value),t=e.length>32?e.substring(0,32):e;if(t.length>0){confirm(`set journal password to \`${t}\`?`)&&(journalPassword=t)}const n=document.querySelectorAll(".icon-lock");journalPassword.length>0?n.forEach((e=>{e.style.display="block"})):n.forEach((e=>{e.style.display="none"})),clearDropDown()}})),o.addEventListener("keypress",(e=>{"Enter"===e.key&&o.blur()}))}function renameCatergory(e,t){e.innerText="";const n=e.innerText,o=document.createElement("input");o.type="text",o.value=n,e.replaceWith(o),o.focus(),o.addEventListener("blur",(()=>{const e=String(o.value),n=e.length>32?e.substring(0,32):e;journal.categories[t].topic=n,loadJournal()})),o.addEventListener("keypress",(e=>{"Enter"===e.key&&o.blur()}))}function editPanelClose(){document.getElementById("editPanel").style.width=0,editingEntry=void 0}function entryPanel(e){if(editingEntry!=e){document.getElementById("editPanel").style.width="1000px",editingEntry=e;const t=journal.entries[editingEntry],n=document.querySelector(".cm-holder");n.innerHTML=t.value,""==n.innerHTML.trim()&&(n.innerHTML="");document.querySelector("#editPanelTitle").value=e;document.querySelector("#editPanelDate").value=journal.entries[e].date}else editPanelClose()}function loadJournal(e){localStorage.setItem("myJournal",JSON.stringify(journal)),console.warn("LOADING JOURNAL",journal),clearDropDown();const t=document.getElementById("categoryTemplate"),n=document.getElementById("main");document.getElementById("journalName").value=journal.title;document.getElementById("editPanel").style.width="0px";const o=document.querySelectorAll(".icon-lock");journalPassword.length>0?o.forEach((e=>{e.style.display="block"})):o.forEach((e=>{e.style.display="none"}));const a=n.querySelectorAll(".category");let r={};for(let e=0;e<journal.categories.length;e++){const o=journal.categories[e],a=document.importNode(t.content,!0),l=a.querySelector("label"),i=a.querySelector(".entryList");l.textContent=o.topic,r[e]=i,l.addEventListener("click",(function(t){const n=this.getBoundingClientRect(),o=n.right-20-10,a=n.top+10;if(t.clientX>=o&&t.clientX<=o+20&&t.clientY>=a&&t.clientY<=a+20){this.classList.toggle("rotate-90");const t=document.createElement("div");t.classList.add("dropDown"),t.appendChild(newDButton("rename category",`renameCatergory(this, ${e})`)),t.appendChild(newDButton("delete category",`deleteCategory(this, ${e})`)),t.appendChild(newDButton("new entry",`newEntry(this, ${e})`)),document.body.appendChild(t),t.style.position="absolute",t.style.left=`${n.left+n.width/2}px`,t.style.top=`${n.bottom}px`,setTimeout((()=>{t.style.height="100px"}),1)}})),n.appendChild(a)}let l=Object.entries(journal.entries);if(e){const t=l.filter((([t,n])=>t.toLowerCase().includes(e.toLowerCase())||n.value.toLowerCase().includes(e.toLowerCase())));l=t}l.sort(((e,t)=>new Date(e[1].date)-new Date(t[1].date)));const i={};for(const[e,t]of l){if(!i[t.category]||!i[t.category].includes(t.date)){document.getElementById("date-container");const e=document.createElement("div");e.className="date-header";const n=document.createElement("span");n.textContent=formatMonthDate(t.date),n.className="highlight",e.appendChild(n),r[t.category].appendChild(e),i[t.category]||(i[t.category]=[]),i[t.category].push(t.date)}const n=document.createElement("button");n.className="entry",n.addEventListener("click",(()=>{entryPanel(e)}));const o=document.createElement("label");o.className="entryTitle",o.textContent=e,n.appendChild(o);const a=document.createElement("label");a.className="entryDate";const l=getWeekIndex(t.date);a.innerHTML=`\n      ${l[0]}\n      <div style="border-bottom: 1px solid #372f45; width: 50%; margin: 2px auto; display: block;"></div>\n      ${l[1]}\n    `,n.appendChild(a),r[t.category].appendChild(n)}a.forEach((e=>{e.remove()}))}function titleInput(e){const t=String(e.value),n=t.length>32?t.substring(0,32):t;journal.title=n,e.value=n}function exportJournal(e,t){let n=journal.title;if(n.length>0||(n="Untitled"),1==t){downloadTxt(JSON.stringify({file:"journal",data:journal},null,2),n+"_journal.txt")}else if(2==t){const e=xorEncryptDecrypt(JSON.stringify(journal),journalPassword);downloadTxt(JSON.stringify({file:"journalEnc",data:e},null,2),n+"_journal.enc")}}function loadFile(e){const t=document.createElement("input");t.type="file",t.accept=".txt, .enc",t.style.display="none",document.body.appendChild(t),t.addEventListener("change",(function(t){const n=t.target.files;if(n.length>0){const t=n[0],o=new FileReader;o.onload=function(t){const n=t.target.result;try{const t=JSON.parse(n);if(console.log("File content: ",t),"journal"===t.file&&t.data)journalPassword="",journal=t.data,loadJournal();else if("journalEnc"===t.file&&t.data){console.log("REQUEST KEY(password)!!");const n=document.createElement("input");n.type="password",n.placeholder="Enter file password",e.replaceWith(n),n.focus(),n.addEventListener("blur",(()=>{const e=n.value,o=function(e){try{const n=xorEncryptDecrypt(t.data,e);return JSON.parse(n)}catch(e){return}}(e);o?(journalPassword=e,journal=o,loadJournal()):alert("wrong password"),n.value=""})),n.addEventListener("keypress",(e=>{"Enter"===e.key&&n.blur()}))}else alert("could not load file"),loadJournal()}catch(e){alert(e),loadJournal()}},o.readAsText(t)}})),t.click(),document.body.removeChild(t)}function navButton(e,t){if(console.log(e,t),e.classList.contains("active"))return e.classList.remove("active"),void document.querySelectorAll(".dropDown").forEach((e=>{e.style.height="0px",setTimeout((()=>{e.remove()}),300)}));document.querySelectorAll(".navbutton").forEach((e=>e.classList.remove("active"))),document.querySelectorAll(".dropDown").forEach((e=>{e.style.height="0",setTimeout((()=>{e.remove()}),300)})),e.classList.toggle("active");const n=document.createElement("div");let o=60;n.classList.add("dropDown"),1==t?(n.appendChild(newDButton("new entry","makeEntry(this)")),n.appendChild(newDButton("new category","makeCategory(this)")),n.appendChild(newDButton("new journal","newJournal(this)")),o=90):2==t?(n.appendChild(newDButton("save","save(this)")),n.appendChild(newDButton("save as","saveAs(this)"))):3==t?n.appendChild(newDButton("from file","loadFile(this)")):4==t||5==t&&(n.appendChild(newDButton("refresh","loadJournal()")),n.appendChild(newDButton("add/change password","changePassword(this)")),n.appendChild(newDButton("Export as Txt","exportJournal(this, 1)")),n.appendChild(newDButton("Export as Encrypted (password)","exportJournal(this, 2)")),n.appendChild(newDButton("print","printPage()")),o=150),document.body.appendChild(n);const a=e.getBoundingClientRect();n.style.position="absolute",n.style.left=`${a.left}px`,n.style.top=`${a.bottom}px`,setTimeout((()=>{n.style.height=o+"px"}),1)}function searchInput(e){console.log("SERACHING:",e.value),editPanelClose(),loadJournal(e.value)}function printPage(){clearDropDown(),window.print()}function deleteEntry(e){const t=document.getElementById("editPanelTitle");t.focus(),t.value="",t.blur()}function newJournal(){const e=confirm("are you sure you want to make a new Journal");clearDropDown(),e&&(journal=journal={author:"",title:"",creationTimestamp:getTimeSt(),categories:[],entries:{}},loadJournal())}function save(){localStorage.setItem("myJournal",JSON.stringify(journal)),clearDropDown()}async function saveAs(){const e=await window.showSaveFilePicker({types:[{description:"Text and Enc Files",accept:{"text/plain":[".txt"],"application/octet-stream":[".enc"]}}]}),t=await e.createWritable(),n=JSON.stringify(journal,null,2);await t.write(n),await t.close(),clearDropDown()}document.addEventListener("DOMContentLoaded",(function(){const e=localStorage.getItem("myJournal");e&&(journal=JSON.parse(e)),loadJournal();const t=document.querySelector(".cm-holder");t.addEventListener("input",(function(){if(editingEntry){const e=journal.entries[editingEntry],n=t.innerHTML;e.value=n,localStorage.setItem("myJournal",JSON.stringify(journal))}}));document.querySelector("#editPanelDate").addEventListener("change",(function(e){if(editingEntry){const t=journal.entries[editingEntry].date,n=e.target.value;journal.entries[editingEntry].date=n,console.log("Selected date:",n),t!=n&&loadJournal()}}));const n=document.querySelector("#editPanelTitle");n.addEventListener("blur",(()=>{const e=editingEntry,t=n.value;if(""===t){confirm("The title is empty. Do you want to delete this entry?")&&(delete journal.entries[e],loadJournal())}else t!=e&&(journal.entries[t]=journal.entries[e],delete journal.entries[e],loadJournal())})),n.addEventListener("keypress",(e=>{"Enter"===e.key&&n.blur()}))})),document.addEventListener("click",(function(e){"BUTTON"!=e.target.tagName&&"LABEL"!=e.target.tagName&&"INPUT"!=e.target.tagName&&clearDropDown()}));