<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fetch and Decompress</title>
  <script src="https://unpkg.com/pako@2.1.0/dist/pako.min.js"></script>
</head>
<body>
  <h1>Anime Data</h1>
  <pre id="output">Loading...</pre>

  <script>
    async function fetchAndDecompress() {
      const outputEl = document.getElementById('output');

      try {
        // 1. Fetch from your API
        const res = await fetch('/api/anime3/data');
        if (!res.ok) throw new Error('Failed to fetch data');

        const json = await res.json();
        const base64 = json.data;

        console.log("base64:", base64)

        function base64ToUint8Array(base64) {
          const raw = atob(base64);
          const arr = new Uint8Array(raw.length);
          for (let i = 0; i < raw.length; i++) {
            arr[i] = raw.charCodeAt(i);
          }
          return arr;
        }

        const compressed = base64ToUint8Array(base64);

        const decompressed = pako.inflate(compressed, { to: 'string' });

        outputEl.textContent = decompressed;
      } catch (err) {
        console.error(err);
        outputEl.textContent = 'Error: ' + err.message;
      }
    }

    fetchAndDecompress();
  </script>
</body>
</html>
